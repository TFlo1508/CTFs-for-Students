<!DOCTYPE html>
<html lang="de">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>WebAnwendungen 2 Frontend Demo</title>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
        <link rel="stylesheet" type="text/css" href="css/style.css">
    </head>

    <body>

		<h1>Beispiel mehrfacher Dateiupload</h1>
		
        <table>
		<tr><td>

                Mit diesem Beispiel sehen Sie, was notwendig ist, um mehrere Dateien zu einem Service zu übertragen<br>
                Wichtig ist, dass beim Formular enctype="multipart/form-data" angegeben wird<br>
                Ebenfalls muss beim Datei-HTML-Element das Attribut multiple angegeben werden<br>
                Das eigentliche Senden übernimmt dann die Ajax Funktion
                <br><br>

                <form id="uploadForm" enctype="multipart/form-data" method="post">
                    <input type="file" id="picture" name="pictures" multiple>
                    <br><br>
                    <input type="submit" value="los gehts">
                </form>

                </form>

                
			</td>
			<td>
				<b>Ergebnis:</b><br><br>
				<div id="output"></div>
			</td>
		</tr>
		</table>
        
        <script>
        $('#uploadForm').submit(function(event) {
            console.log("form submit called");

            // disable default event
            event.preventDefault();

            // convert data of form to object
            var formData = new FormData(this);

            // send form with ajax
            $.ajax({
                url: 'http://localhost:8000/api/dateiuploadmehrere',
                type: 'POST',
                data: formData,
                contentType: false,
                cache: false,
                processData: false,
                dataType: 'json'
            })
            .done(function(response) {
                console.log('response received');
                console.log(response);
                $('#output').html('<p>Operation erfolgreich</p>');
                $('#output').append('<p>Anzahl aufgeladene Dateien: ' + response.length + '</p>');
                response.forEach(element => {
                    $('#output').append(element.fileName + ', ' + element.fileSize + 'byte<br>');
                });
            })
            .fail(function(xhr) {
                console.log('error received');
                console.log(xhr);
                $('#output').html('<p>Es ist ein Fehler aufgetreten</p>');
                $('#output').append('<p>Status: ' + xhr.status + '</p>');
                $('#output').append('<p>Nachricht: ' + xhr.responseText + '</p>');
            });
        });
        
        </script>
    </body>
</html>